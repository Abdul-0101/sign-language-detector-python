<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Language Live Translator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; text-align: center; background: #f0f2f5; margin-top: 20px; }
    video { border: 3px solid #007bff; border-radius: 8px; }
    button { margin: 5px; padding: 10px 20px; font-size: 18px; background: #007bff; border: none; color: white; border-radius: 8px; cursor: pointer; }
    button:hover { background: #0056b3; }
    #predictions button { background: #6f42c1; }
    input { margin: 10px; padding: 10px; width: 300px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; }
    #signPopup { display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; background:white; border:2px solid #007bff; overflow:auto; border-radius:10px; padding:20px;}
    #signPopup img { width:80px; margin:10px; }
    h1 { color: #333; margin-bottom: 10px; }
    h2 { margin-top: 10px; }
  </style>
</head>
<body>

<h1>🤟 Sign Language Live Translator</h1>

<video id="video" width="640" height="480" autoplay playsinline></video>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<h2>Detected Letter: <span id="letter">-</span></h2>
<h2>Full Paragraph:</h2>
<div id="paragraph" style="white-space: pre-wrap; font-size:20px;"></div>

<div id="predictions"></div>

<div>
  <button onclick="backspace()">⌫</button>
  <button onclick="space()">Space ➡</button>
  <button onclick="newline()">New Line ↵</button>
  <button onclick="speak()">🔈 Speak</button>
  <button onclick="clearAll()">🧹 Clear All</button>
  <button onclick="showSigns()">📚 All Signs</button>
</div>

<div>
  <input id="corrected" placeholder="Correct manually...">
  <button onclick="correction()">✏ Correct</button>
</div>

<div id="signPopup">
  <button onclick="hideSigns()">❌ Close</button><br><br>
  <!-- A-Z Sign images -->
  <div id="signImages"></div>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const letterSpan = document.getElementById('letter');
const paragraphDiv = document.getElementById('paragraph');
const predictionsDiv = document.getElementById('predictions');

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => { video.srcObject = stream; });

video.addEventListener('play', () => {
  setInterval(async () => {
    ctx.save();
    ctx.scale(-1, 1);
    ctx.drawImage(video, -canvas.width, 0, canvas.height);
    ctx.restore();
    canvas.toBlob(async blob => {
      const form = new FormData();
      form.append('frame', blob, 'frame.jpg');
      const res = await fetch('/predict', { method: 'POST', body: form });
      const data = await res.json();
      letterSpan.textContent = data.letter || '-';
      paragraphDiv.textContent = data.paragraph || '-';
      suggestWord(data.paragraph.split(' ').pop());
    }, 'image/jpeg');
  }, 300);
});

async function suggestWord(partial) {
  if (!partial) return;
  const res = await fetch(`/predict_word?partial=${partial}`);
  const data = await res.json();
  predictionsDiv.innerHTML = data.predictions.map(w => `<button onclick="appendPrediction('${w}')">${w}</button>`).join(' ');
}

function appendPrediction(word) {
  document.getElementById('corrected').value = word;
  correction();
}

function backspace() { fetch('/backspace', { method: 'POST' }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function space() { fetch('/space', { method: 'POST' }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function newline() { fetch('/newline', { method: 'POST' }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function clearAll() { fetch('/clear', { method: 'POST' }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function speak() { fetch('/speak').then(r => r.json()).then(d => { const audio = new Audio('data:audio/mpeg;base64,' + d.audio); audio.play(); }); }
function correction() {
  const corrected = document.getElementById('corrected').value;
  const form = new FormData();
  form.append('corrected', corrected);
  fetch('/correction', { method: 'POST', body: form }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph);
}

function showSigns() {
  document.getElementById('signPopup').style.display = 'block';
}
function hideSigns() {
  document.getElementById('signPopup').style.display = 'none';
}

const signs = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
signs.forEach(letter => {
  const img = document.createElement('img');
  img.src = `https://www.signasl.org/images/asl_alphabet/${letter}.png`;
  document.getElementById('signImages').appendChild(img);
});
</script>

</body>
</html>
