<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sign Language Translator</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
    video { border: 2px solid #007bff; transform: scaleX(-1); }
    canvas { display: none; }
    button, input { margin: 8px; padding: 10px; font-size: 16px; }
    #signPopup img { width: 80%; max-width: 800px; margin: 10px auto; }
  </style>
</head>
<body>

<h1>Sign Language Translator</h1>

<video id="video" width="320" height="240" autoplay></video>
<canvas id="canvas" width="320" height="240"></canvas>

<h2>Letter: <span id="letter">-</span></h2>
<h3>Paragraph:</h3>
<div id="paragraph" style="white-space:pre-wrap; font-size: 18px;"></div>

<div id="predictions"></div>

<div>
  <button onclick="backspace()">⌫</button>
  <button onclick="space()">Space</button>
  <button onclick="newline()">↵</button>
  <button onclick="speak()">🔈</button>
  <button onclick="clearAll()">🧹</button>
</div>

<input id="corrected" placeholder="Correct manually...">
<button onclick="correction()">✏</button>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const letterSpan = document.getElementById("letter");
const paragraphDiv = document.getElementById("paragraph");

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => { video.srcObject = stream; });

video.addEventListener("play", () => {
  setInterval(() => {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.toBlob(async blob => {
      const form = new FormData();
      form.append("frame", blob);
      const res = await fetch("/predict", { method: "POST", body: form });
      const data = await res.json();
      letterSpan.textContent = data.letter || "-";
      paragraphDiv.textContent = data.paragraph || "";
    }, "image/jpeg", 0.8);
  }, 500);
});

function backspace() { fetch("/backspace", { method: "POST" }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function space() { fetch("/space", { method: "POST" }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function newline() { fetch("/newline", { method: "POST" }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function clearAll() { fetch("/clear", { method: "POST" }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph); }
function correction() {
  const corrected = document.getElementById("corrected").value;
  const form = new FormData();
  form.append("corrected", corrected);
  fetch("/correction", { method: "POST", body: form }).then(r => r.json()).then(d => paragraphDiv.textContent = d.paragraph);
}
function speak() {
  fetch("/speak").then(r => r.json()).then(d => {
    const audio = new Audio("data:audio/mpeg;base64," + d.audio);
    audio.play();
  });
}
</script>

</body>
</html>
