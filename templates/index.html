<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Language Detector 🎉</title>
  <style>
    body {
      text-align: center;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: #fffcf9;
      margin-top: 20px;
      animation: pop 1s ease-in-out infinite alternate;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 18px;
      background: #ff69b4;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    input {
      margin: 10px;
      padding: 8px;
      font-size: 16px;
      width: 300px;
    }
    h1, h2, h3 {
      color: #ff1493;
    }
    #predictions {
      margin: 10px;
      font-weight: bold;
    }
    @keyframes pop {
      0% { transform: scale(1);}
      100% { transform: scale(1.03);}
    }
  </style>
</head>
<body>

<h1>🤟 Funky Live Sign Language Detector</h1>

<video id="video" width="640" height="480" autoplay playsinline style="border:2px dashed #ff1493;"></video>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<h2>Detected Letter: <span id="letter">-</span></h2>
<h3>Forming Word: <span id="word">-</span></h3>

<div id="predictions"></div>

<div>
  <button onclick="backspace()">⌫</button>
  <button onclick="space()">➡</button>
  <button onclick="newline()">↵</button>
  <button onclick="speak()">🔈 Speak</button>
  <button onclick="clearAll()">🧹 Clear All</button>
</div>

<div>
  <input id="corrected" placeholder="Correct manually...">
  <button onclick="correction()">✏ Correct</button>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const letterSpan = document.getElementById('letter');
const wordSpan = document.getElementById('word');
const predictionsDiv = document.getElementById('predictions');

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => { video.srcObject = stream; });

video.addEventListener('play', () => {
  setInterval(async () => {
    ctx.save();
    ctx.scale(-1, 1);
    ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
    ctx.restore();
    canvas.toBlob(async blob => {
      const form = new FormData();
      form.append('frame', blob, 'frame.jpg');
      const res = await fetch('/predict', { method: 'POST', body: form });
      const data = await res.json();
      letterSpan.textContent = data.letter || '-';
      wordSpan.textContent = data.word || '-';
      suggestWord(data.word);
    }, 'image/jpeg');
  }, 300);
});

async function suggestWord(partial) {
  if (!partial) return;
  const res = await fetch(`/predict_word?partial=${partial}`);
  const data = await res.json();
  predictionsDiv.innerHTML = data.predictions.map(w => `<button onclick="appendPrediction('${w}')">${w}</button>`).join(' ');
}

function appendPrediction(word) {
  document.getElementById('corrected').value = word;
  correction();
}

function backspace() { fetch('/backspace', { method: 'POST' }).then(r => r.json()).then(d => wordSpan.textContent = d.word); }
function space() { fetch('/space', { method: 'POST' }).then(r => r.json()).then(d => wordSpan.textContent = d.word); }
function newline() { fetch('/newline', { method: 'POST' }).then(r => r.json()).then(d => wordSpan.textContent = d.word); }
function speak() {
  fetch('/speak').then(r => r.json()).then(d => {
    const audio = new Audio('data:audio/mpeg;base64,' + d.audio);
    audio.play();
  });
}
function clearAll() { fetch('/clear', { method: 'POST' }).then(r => r.json()).then(d => wordSpan.textContent = d.word); }
function correction() {
  const corrected = document.getElementById('corrected').value;
  const form = new FormData();
  form.append('corrected', corrected);
  fetch('/correction', { method: 'POST', body: form }).then(r => r.json()).then(d => wordSpan.textContent = d.word);
}
</script>

</body>
</html>
